(function() {
  const container = document.querySelector('[data-e2e="search_top-item-list"]') || 
                   document.querySelector('#tabs-0-panel-search_top');
  
  if (!container) return [];

  const videos = [];
  const videoItems = container.querySelectorAll('[data-e2e="search_top-item"]');
  
  videoItems.forEach((item, index) => {
    try {
      const videoLink = item.querySelector('a[href*="/video/"]');
      const viewsEl = item.querySelector('[data-e2e="video-views"]');
      const descContainer = item.parentElement.querySelector('[data-e2e="search-card-desc"]');
      const captionEl = descContainer?.querySelector('[data-e2e="search-card-video-caption"]');
      const hashtagLinks = captionEl?.querySelectorAll('[data-e2e="search-common-link"]') || [];
      const hashtags = [...hashtagLinks].map(link => link.textContent.trim());
      const textSpans = captionEl?.querySelectorAll('[data-e2e="new-desc-span"]') || [];
      const description = [...textSpans].map(span => span.textContent.trim()).filter(text => text).join(' ');
      const authorLink = descContainer?.querySelector('[data-e2e="search-card-user-link"]');
      const authorId = descContainer?.querySelector('[data-e2e="search-card-user-unique-id"]');
      
      videos.push({
        index: index + 1,
        url: videoLink?.href || '',
        views: viewsEl?.textContent?.trim() || '0',
        description: description || '',
        hashtags: hashtags || [],
        author: authorId?.textContent?.trim() || '',
        authorUrl: authorLink?.href || ''
      });
    } catch (error) {
      console.warn(`Ошибка при парсинге видео ${index + 1}:`, error);
    }
  });
  
  return videos;
})();

